"use strict";var aaa="这是gulp原始的数据，通过gulp压缩转es5到根目录下名为orignalApp的文件下",abc=function(e){return e+"fff"},express=require("express"),path=require("path"),authMiddleware=require("../middlewares/auth.middleware"),router=express.Router(),querystring=require("querystring"),url=require("url"),cheerio=require("cheerio"),indexjs=require("../workJS/workJS").indexTest,callBack=require("../workJS/workJS").callBack,REQUEST=require("../utils/request").requestList;router.get("/",authMiddleware.getCode,function(e,o,r){console.log("====++++===="),console.log("--获取路径--"),console.log(e.url),console.log("--获取参数（对象）--"),console.log(e.query),console.log("--获取带路由和参数--"),console.log(e.params),e.query.abc="pppppp",console.log(e.query),console.log("--获取路由当前安装的url路径--"),console.log(e.baseUrl),console.log("--获取主题和cookies--"),console.log(e.cookies),console.log(e.body),console.log("--获取主机名/ip--"),console.log(e.hostname),console.log(e.ip),console.log("--获取请求路径--"),console.log(e.path),console.log("--获取协议路径--"),console.log(e.protocol),console.log("--获取当前匹配的路由--"),o.sendFile(path.join(__dirname,"../views/index.html"))}),router.get("/userList",authMiddleware.getCode,function(e,o,r){o.sendFile(path.join(__dirname,"../views/userList.html"))}),router.get("/second",authMiddleware.getCode,authMiddleware.getAccess_token,function(e,o,r){var l=indexjs();console.log("//////////////"),console.log(l),o.render("second",{name:"this is /second",list:l})}),router.get("/callBack",authMiddleware.getCode,function(e,o,r){var l=callBack();console.log(l),o.render("callBack",{name:"this is callBack",list:l})}),router.get("/third",function(e,o,r){console.log("this is request haoniangjiaNews List>>>>>>>>");var l=new Array;params=new Object,params.pageSize=10,params.pageNo=1,REQUEST("/information/list",params).then(function(r){console.log("......|resA|......"),console.log(r);var s=JSON.parse(r).result||"",n=""==s;console.log("data : "+s),console.log("data2 : "+n),console.log(".........这是测试crypto加密模块"),crypto.randomBytes(6,function(e,o){if(e)throw e;console.log("buf.length = "+o.length+",buf.toString('hex') = "+o.toString("hex"))}),console.log("......这是测试querystring解析与格式化 URL 查询字符串"),console.log("参数为"+url.parse(e.url).query||"");var t=querystring.escape(e.url||"");console.log(t+"对给定的 str 进行 URL 编码。"),console.log(querystring.unescape(t)+" 对给定的 str 进行 URL 解码。"),console.log(querystring.parse(url.parse(e.url).query)),console.log("不用转对象直接请求到带有数组的url中数组中的数据："+querystring.parse(url.parse(e.url).query).abc[1]),console.log("<<<检测cheerio"),$=cheerio.load('<h2 class="title">Hello world</h2>',{decodeEntities:!1}),$("h2.title").text("通过cheerio改变后的值，参数decodeEntities: false解决了乱码的问题"),$("h2").addClass("welcome"),console.log($.html());var c=require("utility"),i="我是porcoMar",a=c.sha1(i),u=c.md5(i);console.log("name="+i+",sha1Value="+a+",md5Value="+u),s?(l.concat(s),o.render("third",{name:"this is /third",list:l,content:$("h2").html()})):(l.push("请求成功，数组为空"),console.log(l),o.render("third",{name:"this is /third",list:l,content:$("h2").html()}))})}),router.get("/getUserInfo",authMiddleware.getAccess_token,authMiddleware.getUserInfo,function(e,o,r){console.log(e.query);var l=e.query.back_url;for(var s in e.query)"back_url"!==s&&"code"!==s&&"state"!==s&&(l+="&"+s+"="+e.query[s]);console.log(l),o.redirect(l)});var crypto=require("crypto"),sha1=require("sha1"),accessTokenMiddle=require("../middlewares/accessToken.middleware.js"),weixin=require("../../config/env.config");router.get("/weixin",accessTokenMiddle.accessToken,accessTokenMiddle.ticket,function(e,o,r){console.log("这是req.query里面的参数=>>>>>>>>>>>>>>>>>>>"),console.log(JSON.stringify(e.query)),crypto.randomBytes(16,function(r,l){var s=weixin.appID,n=l.toString("hex"),t=e.query.ticket,c=(new Date).getTime();c=parseInt(c/1e3);var i=e.query.url;console.log("参数："),console.log(n),console.log(t),console.log(c),console.log(i);var a=["noncestr="+n,"jsapi_ticket="+t,"timestamp="+c,"url="+i].sort().join("&");console.log("字符串"),console.log(a);var u=sha1(a);console.log("签名："),console.log("signature:"),console.log(u);var g={code:0,result:{appId:s,timestamp:c,nonceStr:n,signature:u}};o.json(g)})}),module.exports=router;